[TOC]

### ArrayListä¸LinkedList

#### ArrayListåŸºç¡€

##### 1.æ‚è®°

- **å­˜å‚¨**ï¼šArrayList å†…éƒ¨ä½¿ç”¨**åŠ¨æ€æ•°ç»„**å®ç°å…ƒç´ å­˜å‚¨ã€‚å¹¶å…è®¸æ’å…¥æ‰€æœ‰å…ƒç´ ï¼ŒåŒ…æ‹¬ **null**ï¼Œå…ƒç´ **å¯é‡å¤**ã€‚**åŠ¨æ€æ•°ç»„**æ˜¯é€šè¿‡ **transient** ä¿®é¥°çš„ï¼Œé»˜è®¤ä¸è¢«åºåˆ—åŒ–(å› ä¸ºåŠ¨æ€æ•°ç»„å¯èƒ½**æ²¡æœ‰å­˜æ»¡**)ï¼ŒArrayList è‡ªå®šä¹‰äº†åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„æ–¹æ³•ä¿è¯åªå¯¹æ•°ç»„ä¸­çš„**æœ‰æ•ˆå…ƒç´ **è¿›è¡Œåºåˆ—åŒ–ã€‚
- **å¢**ï¼šæ¯æ¬¡**æ·»åŠ å…ƒç´ **æ—¶éƒ½ä¼šæ£€æŸ¥åŠ¨æ€å…ƒç´ æ•°ç»„å®¹é‡æ˜¯å¦è¶³å¤Ÿï¼Œå¯èƒ½ä¼šé¢ä¸´æ•°ç»„**æ‰©å®¹**ä¸å†…å®¹**å¤åˆ¶**ç­‰å¼€é”€é—®é¢˜ã€‚å¦‚æœæ•°ç»„å®¹é‡ä¸å¤Ÿåˆ™ä¼š**åŠ¨æ€æ‰©å®¹**ï¼Œæ‰©å®¹è‡³ **1.5 å€**ï¼Œæ‰©å®¹åä¼š**å¤åˆ¶**åŸæ¥çš„æ•°ç»„ï¼Œå¤åˆ¶çš„å¼€é”€å¾ˆå¤§ï¼Œæ‰€ä»¥ä¸€å®šè¦æ ¹æ®ä¸šåŠ¡åœºæ™¯**æŒ‡å®šåˆå§‹åŒ–å®¹é‡**é˜²æ­¢è¿‡å¤šçš„æ‰©å®¹ä¸å¤åˆ¶å¼€é”€(é˜¿é‡Œè§„èŒƒ)ã€‚
- **åˆ æ”¹æŸ¥**ï¼šæŒ‡å®šä½ç½®çš„æ’å…¥ä¸åˆ é™¤å…ƒç´ æ•ˆç‡ä½ï¼Œå› ä¸ºéœ€è¦**ç§»åŠ¨å…¶å®ƒ**å…ƒç´ ã€‚å®ç°äº† RandomAccess æ¥å£ï¼Œå¯å®ç°**å¿«é€Ÿéšæœº**è®¿é—®ï¼ŒæŒ‰ç…§**ç´¢å¼•**è¿›è¡Œè®¿é—®çš„æ•ˆç‡å¾ˆé«˜ï¼Œæ•ˆç‡ä¸º O(1)ã€‚æŒ‰ç…§å†…å®¹**æŸ¥æ‰¾**å…ƒç´ æ•ˆç‡**è¾ƒä½**ï¼Œæ•ˆç‡ä¸º O(N)ã€‚
- **è¿­ä»£**ï¼šArrayList çš„**è¿­ä»£å™¨**ä¼šè¿”å›ä¸€ä¸ª **å†…éƒ¨ç±» Itr å¯¹è±¡**ï¼Œ**è¿­ä»£æ—¶åˆ é™¤å…ƒç´ **åº”è¯¥ä½¿ç”¨**è¿­ä»£å™¨çš„ remove** æ–¹æ³•è€Œé ArrayList æœ¬èº«çš„ remove æ–¹æ³•ï¼Œå¦åˆ™ä¼šäº§ç”Ÿ **Fail Fast** å¼‚å¸¸ã€‚å½“ç„¶ä¸€èˆ¬ä½¿ç”¨ä¸€æ¬¡ ArrayList çš„ remove æ–¹æ³•æ˜¯æ²¡é—®é¢˜çš„ã€‚
- **modCount** å±æ€§æ˜¯ç»§æ‰¿è‡ª **AbstractList** çš„ï¼Œç”¨æ¥è®°å½• **ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°**ã€‚ç»“æ„å‘ç”Ÿå˜åŒ–æ˜¯æŒ‡æ·»åŠ æˆ–è€…åˆ é™¤è‡³å°‘ä¸€ä¸ªå…ƒç´ çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…æ˜¯è°ƒæ•´å†…éƒ¨æ•°ç»„çš„å¤§å°ï¼Œä»…ä»…åªæ˜¯è®¾ç½®å…ƒç´ çš„å€¼ä¸ç®—ç»“æ„å‘ç”Ÿå˜åŒ–ã€‚å¦‚æœè¿­ä»£æˆ–è€…åºåˆ—åŒ–ä¼šæ£€æŸ¥ modCount ç‰ˆæœ¬ï¼Œå¦‚æœä¸ä¸€è‡´åˆ™ä¼šäº§ç”Ÿ **Fail Fast å¼‚å¸¸**ã€‚
- **å®‰å…¨æ€§**ï¼šArrayList æ˜¯çº¿ç¨‹**ä¸å®‰å…¨**çš„ï¼Œå»ºè®®åœ¨**å•çº¿ç¨‹**ä¸­æ‰ä½¿ç”¨ ArrayListï¼Œå¤šçº¿ç¨‹å¯ä»¥ä½¿ç”¨ Vector ç±»ã€Collections.synchronizedListã€JUC çš„ **CopyOnWriteArrayList** ç±»ç­‰æ–¹æ³•è§£å†³å¹¶å‘å®‰å…¨é—®é¢˜ã€‚

##### 2.ArrayListç±»API

ArrayList åªèƒ½å­˜å‚¨**å¼•ç”¨ç±»å‹**è€Œ**ä¸èƒ½å­˜å‚¨åŸºæœ¬ç±»å‹**(éœ€ä½¿ç”¨å¯¹åº”çš„åŒ…è£…ç±»)ï¼Œå¦‚\<Integer>ã€‚

```java
public boolean add(E obj); 				// å°†æŒ‡å®šå…ƒç´ æ·»åŠ åˆ°æ­¤é›†åˆçš„å°¾éƒ¨
public boolean add(int index, E obj); 	// åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ ï¼Œåé¢çš„å…ƒç´ å¾€åç§»åŠ¨
public E remove(int index); 			// åˆ é™¤æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ ï¼Œè¿”å›è¢«åˆ é™¤çš„å…ƒç´ 
public E get(int index);    			// è¿”å›æŒ‡å®šä½ç½®ä¸Šçš„å…ƒç´ 
public int size();  					// è¿”å›æ­¤é›†åˆä¸­çš„å…ƒç´ æ•°ç›®
// å°†æ•°ç»„åˆ—è¡¨çš„å­˜å‚¨å®¹é‡å‰Šå‡åˆ°å½“å‰å°ºå¯¸ï¼Œç¡®ä¿æ•°ç»„ä¸ä¼šæœ‰æ–°å…ƒç´ æ·»åŠ çš„æ—¶å€™è°ƒç”¨
public void trimToSize();  	
public void set(int index, E obj);		// è®¾ç½®æ•°ç»„åˆ—è¡¨æŒ‡å®šä½ç½®çš„å€¼ï¼Œè¦†ç›–åŸæœ‰å†…å®¹
```

åˆå§‹åŒ–æ—¶ä¸€å®šè¦æŒ‡å®šå®¹é‡ï¼Œé¿å…å¤šæ¬¡è‡ªåŠ¨æ‰©å®¹å½±å“æ€§èƒ½ã€‚

```java
ArrayList<Employee> staff = new ArrayList<>(100);  
```

##### 3.çº¿ç¨‹å®‰å…¨

ArrayList ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å…¶åº•å±‚ä»¥åŠ¨æ€æ•°ç»„å­˜å‚¨ï¼Œå¦‚æœå¤šçº¿ç¨‹åŒæ—¶æ“ä½œ List é›†åˆï¼Œæ¯”å¦‚åŒæ—¶å¢åŠ ã€åˆ é™¤å…ƒç´ å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œå¦‚æ•°ç»„ä¸‹æ ‡è¶Šç•Œå¼‚å¸¸ã€‚ 

å¦‚ä½•è§£å†³ï¼Ÿ

(1) ä½¿ç”¨ **Vertor** é›†åˆã€‚

(2) ä½¿ç”¨ **Collections.synchronizedList**ã€‚ä¼šå¾—åˆ°ä¸€ä¸ªåŠ é”äº†çš„ Listã€‚

(3) æ¨èï¼šå¤šçº¿ç¨‹åœºæ™¯ä½¿ç”¨ JUC ä¸­çš„ **CopyOnWriteArrayList**ã€‚

#### ArrayListæºç åˆ†æ

ä¸‹é¢çš„åˆ†æåŸºäº **JDK8**ã€‚æœ€æ–°çš„ ArrayList æºç æœ‰æ”¹åŠ¨ã€‚

##### 1.åŸºæœ¬å±æ€§

```java
public class ArrayList<E> extends AbstractList<E>
        implements List<E>, RandomAccess, Cloneable, java.io.Serializable {
    // ç‰ˆæœ¬å·
    private static final long serialVersionUID = 8683452581122892189L;
    // é»˜è®¤å®¹é‡
    private static final int DEFAULT_CAPACITY = 10;
    // ç©ºå¯¹è±¡æ•°ç»„
    private static final Object[] EMPTY_ELEMENTDATA = {};
    // ç¼ºçœç©ºå¯¹è±¡æ•°ç»„
    private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};
    // å­˜æ”¾å…ƒç´ æ•°ç»„
    transient Object[] elementData;
    // å®é™…å…ƒç´ å¤§å°, é»˜è®¤ä¸º0
    private int size;
    // æœ€å¤§æ•°ç»„å®¹é‡
    private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;
}
```

ArrayList åŸºäº**åŠ¨æ€æ•°ç»„**å­˜å‚¨ï¼ŒåŒæ—¶ä¹Ÿå®ç°äº† RandomAccess æ¥å£ï¼Œæ‰€ä»¥æ”¯æŒ**å¿«é€Ÿéšæœºè®¿é—®**ã€‚å­˜æ”¾å…ƒç´ æ•°ç»„ä¸º **elementData**ã€‚

<img src="assets/image-20220530211849991.png" alt="image-20220530211849991" style="zoom:33%;" />

##### 2.åˆå§‹åŒ–

ä¸»è¦æ˜¯åˆå§‹åŒ–ä¸€ä¸ªæŒ‡å®šå¤§å°çš„**æ•°ç»„**ã€‚

```java
/**
 * ä¸å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•
 */
public ArrayList() {
    // ç›´æ¥å°†ç©ºæ•°ç»„èµ‹ç»™elementData
    this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;
}

/**
 * åˆå§‹åŒ–å®¹é‡ä¸ºinitialCapacityçš„æ„é€ æ–¹æ³•
 */
public ArrayList(int initialCapacity) {
    // å¦‚æœåˆå§‹åŒ–æ—¶ArrayListå¤§å°0
    if (initialCapacity > 0) {
        // newä¸€ä¸ªè¯¥å¤§å°çš„objectæ•°ç»„èµ‹ç»™elementData
        this.elementData = new Object[initialCapacity];
    } else if (initialCapacity == 0) { // å¦‚æœå¤§å°ä¸º0
        // å°†ç©ºæ•°ç»„èµ‹ç»™elementData
        this.elementData = EMPTY_ELEMENTDATA;
    } else { 
        // å°äº0åˆ™æŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸
        throw new IllegalArgumentException("Illegal Capacity: " + initialCapacity);
    }
}
```

##### 3.åŸºæœ¬æ–¹æ³•

ä¸‹é¢æ˜¯ä¸€äº›å¾ˆåŸºç¡€çš„æ–¹æ³•ã€‚

```java
public int size() {
    return size;
}
public boolean isEmpty() {
    return size == 0;
}
public boolean contains(Object o) {
    return indexOf(o) >= 0;
}
```

##### 4.æ·»åŠ å…ƒç´ ä¸æ‰©å®¹

è¿™æ˜¯**é‡ç‚¹**ã€‚æ·»åŠ å…ƒç´ çš„ add æ–¹æ³•å¦‚ä¸‹ã€‚**é»˜è®¤**æ·»åŠ åˆ°æ•°ç»„**æœ€åçš„**ä½ç½®ã€‚

```java
public boolean add(E e) {
    // æ‰©å®¹(ç¡®ä¿å®¹é‡è¶³å¤Ÿ)
    ensureCapacityInternal(size + 1);  // Increments modCount!!
    // å°†eèµ‹å€¼ç»™elementDataçš„size+1çš„ä½ç½®
    elementData[size++] = e;
    return true;
}
```

**æ·»åŠ å…ƒç´ **æ—¶ä½¿ç”¨ **ensureCapacityInternal() æ–¹æ³•**æ¥ä¿è¯å®¹é‡**è¶³å¤Ÿ**ã€‚å¦‚æœåˆå§‹åŒ–æ—¶**æ²¡æœ‰æŒ‡å®š**æ•°ç»„å¤§å°ï¼Œé‚£ä¹ˆ**ç¬¬ä¸€æ¬¡**æ·»åŠ å…ƒç´ æ—¶**ä¼šæ‰©å®¹**ï¼Œè¿™æ—¶å€™å°±ä¼š**æ‰©å®¹åˆ°é»˜è®¤çš„ 10**ï¼Œå¦‚æœæŒ‡å®šäº†å®¹é‡ï¼Œé‚£å°±æŒ‰å®¹é‡ **1.5** æ‰©å®¹äº†ã€‚

```java
/**
 * ç¡®ä¿å®¹é‡è¶³å¤Ÿ
 */
private void ensureCapacityInternal(int minCapacity) {
    
    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));
}

/**
 * åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹
 *
 * @param minCapacity
 */
private void ensureExplicitCapacity(int minCapacity) {
    // å¢åŠ ç»“æ„ä¿®æ”¹è®¡æ•°å™¨
    modCount++;
    // å¦‚æœæœ€å°éœ€è¦ç©ºé—´æ¯”elementDataçš„å†…å­˜ç©ºé—´è¦å¤§ï¼Œåˆ™éœ€è¦æ‰©å®¹
    if (minCapacity - elementData.length > 0)
        grow(minCapacity);
}

// é¦–å…ˆè®¡ç®—capacity
private static int calculateCapacity(Object[] elementData, int minCapacity) {
    // å¦‚æœæ•°ç»„æ˜¯ç©ºçš„
    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
        // å¦‚æœä¹‹å‰ä¸ºç©ºåˆ™æ‰©å®¹åˆ°é»˜è®¤å®¹é‡DEFAULT_CAPACITY=10
        return Math.max(DEFAULT_CAPACITY, minCapacity);
    }
    // minCapacityæ˜¯å½“å‰æ‰€éœ€çš„æœ€å°å®¹é‡
    return minCapacity;
}
```

å¦‚æœå®¹é‡ä¸å¤Ÿæ—¶ï¼Œéœ€è¦ä½¿ç”¨ **grow() æ–¹æ³•è¿›è¡Œæ‰©å®¹**ï¼Œæ–°å®¹é‡çš„å¤§å°ä¸º **oldCapacity + (oldCapacity >> 1)**ï¼Œä¹Ÿå°±æ˜¯æ—§å®¹é‡çš„ **1.5 å€**ã€‚elementData æ•°ç»„ä¼šéšç€å®é™…å…ƒç´ ä¸ªæ•°çš„å¢å¤šè€Œé‡æ–°åˆ†é…ã€‚

```java
/**
 * æ‰©å®¹ä»¥ç¡®ä¿å®ƒå¯ä»¥è‡³å°‘æŒæœ‰ç”±å‚æ•°æŒ‡å®šçš„å…ƒç´ çš„æ•°ç›®
 *
 * @param minCapacity å½“å‰æ‰€éœ€çš„æœ€å°å®¹é‡
 */
private void grow(int minCapacity) {
    // åŸå§‹æ•°æ®æ•°ç»„é•¿åº¦
    int oldCapacity = elementData.length;
    // æ‰©å®¹è‡³åŸæ¥çš„1.5å€
    int newCapacity = oldCapacity + (oldCapacity >> 1);
    // å†åˆ¤æ–­ä¸€ä¸‹æ–°æ•°ç»„çš„å®¹é‡å¤Ÿä¸å¤Ÿï¼Œå¤Ÿäº†å°±ç›´æ¥ä½¿ç”¨è¿™ä¸ªé•¿åº¦åˆ›å»ºæ–°æ•°ç»„ï¼Œ
    // ä¸å¤Ÿå°±å°†æ•°ç»„é•¿åº¦è®¾ç½®ä¸ºéœ€è¦çš„é•¿åº¦
    if (newCapacity - minCapacity < 0)
        newCapacity = minCapacity;
    // è‹¥é¢„è®¾å€¼å¤§äºé»˜è®¤çš„æœ€å¤§å€¼æ£€æŸ¥æ˜¯å¦æº¢å‡º
    if (newCapacity - MAX_ARRAY_SIZE > 0)
        newCapacity = hugeCapacity(minCapacity);
    // è°ƒç”¨Arrays.copyOfæ–¹æ³•å°†elementDataæ•°ç»„æŒ‡å‘æ–°çš„å†…å­˜ç©ºé—´æ—¶newCapacityçš„è¿ç»­ç©ºé—´
    // å¹¶å°†elementDataçš„æ•°æ®å¤åˆ¶åˆ°æ–°çš„å†…å­˜ç©ºé—´
    elementData = Arrays.copyOf(elementData, newCapacity);
}
```

**æ‰©å®¹æ“ä½œ**éœ€è¦è°ƒç”¨ Arrays.copyOf() æŠŠåŸæ•°ç»„æ•´ä¸ª**å¤åˆ¶**åˆ°æ–°æ•°ç»„ä¸­ï¼Œè¿™ä¸ªæ“ä½œ**ä»£ä»·å¾ˆé«˜**ï¼Œå› æ­¤ä¸€å®šè¦åœ¨åˆ›å»º ArrayList å¯¹è±¡æ—¶å°±**æŒ‡å®š**å¤§æ¦‚çš„å®¹é‡å¤§å°ï¼Œ**å‡å°‘æ‰©å®¹æ“ä½œçš„æ¬¡æ•°**ã€‚

ä¹Ÿå¯ä»¥åœ¨**æŒ‡å®šç´¢å¼•**å¤„æ·»åŠ å…ƒç´ ã€‚è¿™é‡Œéœ€è¦çš„æ“ä½œæ˜¯å°† index ä½ç½®åŠä»¥åçš„å…ƒç´ æ¬è¿åˆ° index + 1 ä¹‹åï¼Œè¿™ä¸ªæ“ä½œå¼€é”€ä¹ŸæŒºå¤§ã€‚

```java
/**
 * åœ¨ArrayListçš„indexä½ç½®ï¼Œæ·»åŠ å…ƒç´ elementï¼Œä¼šæ£€æŸ¥æ·»åŠ çš„ä½ç½®å’Œå®¹é‡
 *
 * @param index   æŒ‡å®šå…ƒç´ å°†è¢«æ’å…¥çš„ç´¢å¼•
 * @param element è¦æ’å…¥çš„å…ƒç´ 
 */
public void add(int index, E element) {
    // åˆ¤æ–­indexæ˜¯å¦è¶Šç•Œ
    rangeCheckForAdd(index);
    // æ‰©å®¹
    ensureCapacityInternal(size + 1);  // Increments modCount!!
    // public static void arraycopy(Object src, int srcPos, Object dest, int destPos, int length)
    // src:æºæ•°ç»„; srcPos:æºæ•°ç»„è¦å¤åˆ¶çš„èµ·å§‹ä½ç½®; dest:ç›®çš„æ•°ç»„; destPos:ç›®çš„æ•°ç»„æ”¾ç½®çš„èµ·å§‹ä½ç½®; length:å¤åˆ¶çš„é•¿åº¦
    // å°†elementDataä»indexä½ç½®å¼€å§‹, å¤åˆ¶åˆ°elementDataçš„index+1å¼€å§‹çš„è¿ç»­ç©ºé—´
    System.arraycopy(elementData, index, elementData, index + 1, size - index);
    // åœ¨elementDataçš„indexä½ç½®èµ‹å€¼element
    elementData[index] = element;
    // ArrayListçš„å¤§å°åŠ ä¸€
    size++;
}
```

##### 5.è·å–å…ƒç´ 

è·å–å…ƒç´ ç”¨ **get** æ–¹æ³•ã€‚å³ç›´æ¥é€šè¿‡**ç´¢å¼•**è·å–å¯¹åº”ä½ç½®çš„å…ƒç´ ï¼Œé€Ÿåº¦æå¿«ã€‚

```java
public E get(int index) {
    // æ£€æŸ¥è¾“å…¥çš„ç´¢å¼•æœ‰æ²¡æœ‰è¶Šç•Œ
    rangeCheck(index);
	// è¿”å›æ•°æ®æ•°ç»„æŒ‡å®šç´¢å¼•çš„å…ƒç´ 
    return elementData(index);
}

E elementData(int index) {
    return (E) elementData[index];
}
```

indexOf ç”¨äºè¿”å›ä¸€ä¸ªå€¼åœ¨æ•°ç»„**é¦–æ¬¡å‡ºç°çš„ä½ç½®**ï¼Œä¼šæ ¹æ®æ˜¯å¦ä¸º null ä½¿ç”¨ä¸åŒæ–¹å¼åˆ¤æ–­ã€‚ä¸å­˜åœ¨å°±è¿”å› -1ã€‚æ—¶é—´å¤æ‚åº¦ä¸ºO(N)ã€‚

```java
public int indexOf(Object o) {
    if (o == null) {
        for (int i = 0; i < size; i++)
            if (elementData[i] == null)
                return i;
    } else {
        for (int i = 0; i < size; i++)
            if (o.equals(elementData[i]))
                return i;
    }
    return -1;
}
```

lastIndexOf æ–¹æ³•æ•ˆæœç±»ä¼¼ï¼Œåªæ˜¯æ˜¯åè¿‡æ¥ä»åé¢æ‰¾ç´¢å¼•ä½ç½®ã€‚

##### 6.æ›´æ–°å…ƒç´ 

æ›´æ–°å…ƒç´ ä¾ç„¶æ˜¯é€šè¿‡**ç´¢å¼•**æ¥çš„ã€‚æ›´æ–°ä¹‹åä¼šè¿”å›åŸå§‹ç´¢å¼•å¤„çš„æ—§å…ƒç´ ã€‚

```java
public E set(int index, E element) {
    rangeCheck(index);	// ç´¢å¼•æœ‰æ•ˆæ€§æ£€æŸ¥
	// è·å–æ—§å…ƒç´ 
    E oldValue = elementData(index);
    // è®¾ç½®æ–°å…ƒç´ 
    elementData[index] = element;
    // è¿”å›æ—§å…ƒç´ 
    return oldValue;
}
```

##### 7.åºåˆ—åŒ–

ArrayList åŸºäº**æ•°ç»„**å®ç°ï¼Œå¹¶ä¸”å…·æœ‰**åŠ¨æ€æ‰©å®¹**ç‰¹æ€§ï¼Œå› æ­¤ä¿å­˜å…ƒç´ çš„æ•°ç»„**ä¸ä¸€å®šéƒ½ä¼šè¢«ä½¿ç”¨**ï¼Œé‚£ä¹ˆ**å°±æ²¡å¿…è¦å…¨éƒ¨**è¿›è¡Œåºåˆ—åŒ–ã€‚æ‰€ä»¥ä¿å­˜å…ƒç´ çš„æ•°ç»„ **elementData** ä½¿ç”¨ **transient** ä¿®é¥°ï¼Œè¯¥å…³é”®å­—å£°æ˜æ•°ç»„é»˜è®¤**ä¸ä¼šè¢«åºåˆ—åŒ–**ã€‚

```java
transient Object[] elementData; // non-private to simplify nested class access
```

ArrayList å®ç°äº† **writeObject**() å’Œ **readObject**() æ¥æ§åˆ¶==**åªåºåˆ—åŒ–æ•°ç»„ä¸­æœ‰å…ƒç´ å¡«å……é‚£éƒ¨åˆ†**==å†…å®¹ã€‚æ•°ç»„æ²¡æœ‰å­˜å…ƒç´ çš„éƒ¨åˆ†**ä¸**åºåˆ—åŒ–ã€‚å½“å†™å…¥åˆ°è¾“å‡ºæµæ—¶ï¼Œå…ˆå†™å…¥å®¹é‡ï¼Œå†ä¾æ¬¡å†™å…¥æ¯ä¸€ä¸ªå…ƒç´ ï¼›å½“è¯»å‡ºè¾“å…¥æµæ—¶ï¼Œå…ˆè¯»å–å®¹é‡ï¼Œå†ä¾æ¬¡è¯»å–æ¯ä¸€ä¸ªå…ƒç´ ã€‚

æ³¨æ„ï¼šåºåˆ—åŒ–æ—¶ä¹Ÿä¼š**æ£€æŸ¥ modCount**ï¼Œå¦‚æœåºåˆ—åŒ–æ—¶å¹¶å‘**ä¿®æ”¹**åˆ—è¡¨ï¼Œå¯èƒ½é€ æˆ Fail Fast è€ŒæŠ›å¼‚å¸¸ã€‚

```java
/**
 * ä¿å­˜æ•°ç»„å®ä¾‹çš„çŠ¶æ€åˆ°ä¸€ä¸ªæµ(å³åºåˆ—åŒ–)ã€‚å†™å…¥è¿‡ç¨‹æ•°ç»„è¢«æ›´æ”¹ä¼šæŠ›å‡ºå¼‚å¸¸
 */
private void writeObject(java.io.ObjectOutputStream s)
    throws java.io.IOException {
    // Write out element count, and any hidden stuff
    int expectedModCount = modCount;
    // æ‰§è¡Œé»˜è®¤çš„ååºåˆ—åŒ–/åºåˆ—åŒ–è¿‡ç¨‹ã€‚å°†å½“å‰ç±»çš„éé™æ€å’Œéç¬æ€å­—æ®µå†™å…¥æ­¤æµ
    s.defaultWriteObject();
    // å†™å…¥å¤§å°
    s.writeInt(size);
    // æŒ‰é¡ºåºå†™å…¥æ‰€æœ‰å…ƒç´ 
    for (int i = 0; i < size; i++) {
        s.writeObject(elementData[i]);
    }
    if (modCount != expectedModCount) {
        throw new ConcurrentModificationException();
    }
}
```

```java
/**
 * ä»æµä¸­é‡æ„ArrayListå®ä¾‹(å³ååºåˆ—åŒ–)ã€‚
 */
private void readObject(java.io.ObjectInputStream s)
    throws java.io.IOException, ClassNotFoundException {
    elementData = EMPTY_ELEMENTDATA;
    // æ‰§è¡Œé»˜è®¤çš„åºåˆ—åŒ–/ååºåˆ—åŒ–è¿‡ç¨‹
    s.defaultReadObject();
    // è¯»å…¥æ•°ç»„é•¿åº¦
    s.readInt(); // ignored
    if (size > 0) {
        // åƒclone()æ–¹æ³• ï¼Œä½†æ ¹æ®å¤§å°è€Œä¸æ˜¯å®¹é‡åˆ†é…æ•°ç»„
        int capacity = calculateCapacity(elementData, size);
        SharedSecrets.getJavaOISAccess().checkArray(s, Object[].class, capacity);
        ensureCapacityInternal(size);
        Object[] a = elementData;
        // è¯»å…¥æ‰€æœ‰å…ƒç´ 
        for (int i = 0; i < size; i++) {
            a[i] = s.readObject();
        }
    }
}
```

**åºåˆ—åŒ–**æ—¶éœ€è¦ä½¿ç”¨ ObjectOutputStream çš„ writeObject() å°†å¯¹è±¡è½¬æ¢ä¸º**å­—èŠ‚æµ**å¹¶è¾“å‡ºã€‚è€Œ writeObject() æ–¹æ³•åœ¨ä¼ å…¥çš„å¯¹è±¡**å­˜åœ¨ writeObject**() çš„æ—¶å€™ä¼šå»**åå°„**è°ƒç”¨è¯¥å¯¹è±¡çš„ writeObject() æ¥å®ç°**åºåˆ—åŒ–**ã€‚ååºåˆ—åŒ–ä½¿ç”¨çš„æ˜¯  ObjectInputStream çš„ **readObject**() æ–¹æ³•ï¼ŒåŸç†ç±»ä¼¼ã€‚

```java
ArrayList list = new ArrayList();
ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(file));
oos.writeObject(list);
```

##### 8.åˆ é™¤å…ƒç´ 

åˆ é™¤å…ƒç´ éœ€è¦è°ƒç”¨ **System.arraycopy()** å°† index + 1 **åé¢**çš„å…ƒç´ éƒ½**å¤åˆ¶**åˆ° index ä½ç½®ä¸Šï¼Œè¯¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º **O(N)**ï¼Œéšè— ArrayList åˆ é™¤å…ƒç´ çš„ä»£ä»·ä¹Ÿå¾ˆé«˜ã€‚

æ³¨æ„ï¼š**remove æ“ä½œä¼šä¿®æ”¹ modCount å€¼**ã€‚

```java
public E remove(int index) {
    // åˆ¤æ–­æ˜¯å¦è¶Šç•Œ
    rangeCheck(index);
    
    // removeæ“ä½œä¼šä¿®æ”¹modCountå€¼
    modCount++;
    // è¯»å–æ—§å€¼
    E oldValue = elementData(index);
    // è·å–indexä½ç½®å¼€å§‹åˆ°æœ€åä¸€ä¸ªä½ç½®çš„ä¸ªæ•°
    int numMoved = size - index - 1;
    if (numMoved > 0)
        // å°†elementDataæ•°ç»„index+1ä½ç½®å¼€å§‹æ‹·è´åˆ°elementDataä»indexå¼€å§‹çš„ç©ºé—´
        System.arraycopy(elementData, index + 1, elementData, index, numMoved);
    // ä½¿size-1 ï¼Œè®¾ç½®elementDataçš„sizeä½ç½®ä¸ºç©ºï¼Œè®©GCæ¥æ¸…ç†å†…å­˜ç©ºé—´
    elementData[--size] = null; // ä¾¿äºåƒåœ¾å›æ”¶å™¨å›æ”¶
    return oldValue;
}
```

##### 9.è¿­ä»£ä¸åˆ é™¤

**è¿­ä»£å™¨**çš„å¸¸è§**è¯¯ç”¨**å°±æ˜¯åœ¨è¿­ä»£çš„**ä¸­é—´**è°ƒç”¨**å®¹å™¨çš„åˆ é™¤æ–¹æ³•**ã€‚

```java
List<String> list = new ArrayList<>();
list.add("str1");
list.add("str2");
list.add("str3");
for (String s : list) {
    if ("str1".equals(s)) {
        // è¿™é‡Œä½¿ç”¨äº†Listæ¥å£æä¾›çš„removeæ–¹æ³•
        list.remove(s);
    }
}
```

è¿™çœ‹èµ·æ¥æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯è¿è¡Œå°±ä¼šæŠ›å‡º **ConcurrentModificationException** å¼‚å¸¸ã€‚æ¯å½“ä½¿ç”¨**è¿­ä»£å™¨éå†å…ƒç´ **æ—¶ï¼Œå¦‚æœ**ä¿®æ”¹äº†åˆ—è¡¨**(**æ·»åŠ ã€åˆ é™¤**å…ƒç´ )ï¼Œå°±ä¼š**æŠ›å‡ºå¼‚å¸¸**ï¼Œç”±äº **foreach** åŒæ ·ä½¿ç”¨çš„æ˜¯**è¿­ä»£å™¨**ï¼Œæ‰€ä»¥ä¹Ÿæœ‰åŒæ ·çš„æƒ…å†µã€‚

è¿”å›**è¿­ä»£å™¨**æºç ä¸­è¿”å›çš„æ˜¯ä¸€ä¸ª**å†…éƒ¨ç±» Itr** çš„å¯¹è±¡ã€‚

```java
public Iterator<E> iterator() {
    return new Itr();
}
```

å¦‚æœä¸Šé¢çš„ä»£ç æ”¹æˆä¸‹é¢è¿™æ ·å°±ä¸ä¼šæŠ›å¼‚å¸¸äº†ã€‚

```java
List<String> list = new ArrayList<>();
list.add("str1");
list.add("str2");
list.add("str3");

int i = 0;
Iterator iterator = list.iterator();
while (iterator.hasNext()) {
    if ("str1".equals(iterator.next())) {
        // è¿™é‡Œä½¿ç”¨äº†è¿­ä»£å™¨è¿”å›çš„removeæ–¹æ³•è€Œä¸æ˜¯listå®ç°çš„removeæ–¹æ³•
        iterator.remove();
    }
}
// åˆ æ‰äº†str1æ‰€ä»¥0å·ä½ç½®å°±æ˜¯str2äº†
System.out.println(list.get(0));
```

è¿™ä¸ªå†…éƒ¨ç±» Itr å¦‚ä¸‹ï¼š

```java
/**
 * é€šç”¨çš„è¿­ä»£å™¨å®ç°
 */
private class Itr implements Iterator<E> {
    int cursor;       // æ¸¸æ ‡ï¼Œä¸‹ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œé»˜è®¤åˆå§‹åŒ–ä¸º0
    int lastRet = -1; // ä¸Šæ¬¡è®¿é—®çš„å…ƒç´ çš„ä½ç½®
    
    // è®°å½•è·å–è¿­ä»£å™¨æ—¶çš„modCountï¼Œè¿­ä»£è¿‡ç¨‹ä¸è¿è¡Œä¿®æ”¹æ•°ç»„ï¼Œå¦åˆ™å°±æŠ›å‡ºå¼‚å¸¸
    int expectedModCount = modCount;

    // æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ª
    public boolean hasNext() {
        return cursor != size;
    }

    // ä¸‹ä¸€ä¸ªå…ƒç´ 
    @SuppressWarnings("unchecked")
    public E next() {
        // æ£€æŸ¥æ•°ç»„æ˜¯å¦è¢«ä¿®æ”¹
        checkForComodification();
        int i = cursor;
        if (i >= size)
            throw new NoSuchElementException();
        Object[] elementData = ArrayList.this.elementData;
        if (i >= elementData.length)
            throw new ConcurrentModificationException();
        cursor = i + 1;// å‘åç§»åŠ¨æ¸¸æ ‡
        return (E) elementData[lastRet = i];// è®¾ç½®è®¿é—®çš„ä½ç½®å¹¶è¿”å›è¿™ä¸ªå€¼
    }

    // åˆ é™¤å…ƒç´ 
    public void remove() {
        if (lastRet < 0)
            throw new IllegalStateException();
        checkForComodification(); // æ£€æŸ¥æ•°ç»„æ˜¯å¦è¢«ä¿®æ”¹
		// ç”¨è¿­ä»£å™¨çš„åˆ é™¤æ–¹æ³•ä¼šè‡ªå·±æ›´æ–°modCountå€¼
        try {
            // è¿™é‡Œè°ƒç”¨ArrayListè‡ªèº«çš„removeæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šä¿®æ”¹modCountå€¼
            ArrayList.this.remove(lastRet);
            cursor = lastRet;
            lastRet = -1;
            // ä¿®æ”¹è¿­ä»£å™¨å†…éƒ¨çš„expectedModCountä¸ºåˆ é™¤åå½“å‰æœ€æ–°çš„modCountå€¼ï¼Œè¿™æ ·å°±ä¸ä¼šæŠ›å¼‚å¸¸
            expectedModCount = modCount;
        } catch (IndexOutOfBoundsException ex) {
            throw new ConcurrentModificationException();
        }
    }

    @Override
    @SuppressWarnings("unchecked")
    public void forEachRemaining(Consumer<? super E> consumer) {
        // å¿½ç•¥....
    }

    // æ£€æŸ¥æ•°ç»„æ˜¯å¦è¢«ä¿®æ”¹ï¼šå°±æ˜¯åˆ¤æ–­å½“å‰åˆ—è¡¨çš„modCountä¸ç”Ÿæˆè¿­ä»£å™¨æ—¶çš„modCountæ˜¯å¦ä¸€è‡´
    final void checkForComodification() {
        if (modCount != expectedModCount)
            throw new ConcurrentModificationException();
    }
}
```

å¯ä»¥æ˜æ˜¾çš„çœ‹åˆ°å…±æœ‰**ä¸¤ä¸ª remove()** æ–¹æ³•ï¼Œä¸€ä¸ªå±äº ArrayList **æœ¬èº«**ï¼Œè¿˜æœ‰ä¸€ä¸ªå±äºå…¶**å†…éƒ¨ç±» Itr**ã€‚

ArrayList ä¸­æœ‰ä¸€ä¸ª **modCount** å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯ç»§æ‰¿è‡ª **AbstractList**ï¼Œä¿å­˜äº†å¯¹ ArrayList è¿›è¡Œ**ç»“æ„æ€§æ“ä½œçš„æ¬¡æ•°**ï¼Œå½“**æ·»åŠ æˆ–è€…åˆ é™¤**å…ƒç´ æ—¶ï¼ŒmodeCount éƒ½ä¼šè¿›è¡Œå¯¹åº”æ¬¡æ•°çš„**å¢åŠ **ã€‚ç›¸å½“äºè®°å½•äº†**ç»“æ„æ€§å˜åŒ–**ï¼Œå³**æ·»åŠ ã€æ’å…¥ã€åˆ é™¤**å…ƒç´ ï¼Œåªæ˜¯**ä¿®æ”¹**å…ƒç´ çš„å†…å®¹**ä¸ç®—**ç»“æ„æ€§å˜åŒ–ã€‚

ä½¿ç”¨ ArrayList çš„ **iterator**() æ–¹æ³•è·å–åˆ°**è¿­ä»£å™¨**è¿›è¡Œéå†æ—¶ï¼Œä¼šæŠŠ ArrayList **å½“å‰çŠ¶æ€ä¸‹çš„ modCount èµ‹å€¼ç»™ Itr ç±»çš„ expectedModCount** å±æ€§ï¼Œç›¸å½“äºåˆ›å»ºè¿­ä»£å™¨æ—¶å€™å¯¹å¤–éƒ¨çš„ modCount è®°å½•äº†ä¸€ä¸ª**ç‰ˆæœ¬å¿«ç…§**ã€‚å¦‚æœåœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä½¿ç”¨äº† ArrayList çš„ **remove**() æˆ– **add**() æ–¹æ³•ï¼Œå®ƒä»¬ä¼šä¿®æ”¹å¤–éƒ¨çš„ modCount å°±ä¼šåŠ  1 ï¼Œä½†æ˜¯è¿­ä»£å™¨ä¸­çš„ **expectedModeCount** å¹¶æ²¡æœ‰å˜åŒ–ï¼Œå½“å†ä½¿ç”¨è¿­ä»£å™¨çš„ next() æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè°ƒç”¨ **checkForComodification**() æ–¹æ³•ï¼Œé€šè¿‡å¯¹æ¯”å‘ç°ç°åœ¨çš„ expectedModCount å·²ç»ä¸å¤–éƒ¨çš„ modCount **ä¸ä¸€è‡´**äº†ï¼Œåˆ™ä¼šæŠ›å‡ºConcurrentModificationException å¼‚å¸¸ã€‚

ä½†æ˜¯**å¦‚æœä½¿ç”¨**å†…éƒ¨ç±» **Itr è¿­ä»£å™¨æä¾›çš„ remove()æ–¹æ³•**ï¼Œå®ƒä¼šè°ƒç”¨ ArrayList æä¾›çš„ remove æ–¹æ³•ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªæ“ä½œï¼š**==expectedModCount = modCount==**;ï¼Œè¿™ä¼šä¿®æ”¹å½“å‰è¿­ä»£å™¨å†…éƒ¨è®°å½•çš„ expectedModCount çš„å€¼ï¼Œæ‰€ä»¥å°±ä¸ä¼šå­˜åœ¨ç‰ˆæœ¬ä¸ä¸€è‡´é—®é¢˜ï¼Œä¹Ÿå°±ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

ç»¼ä¸Šï¼š**åœ¨å•çº¿ç¨‹çš„éå†è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¦è¿›è¡Œ remove æ“ä½œï¼Œåº”è¯¥è°ƒç”¨è¿­ä»£å™¨çš„ remove æ–¹æ³•è€Œä¸æ˜¯é›†åˆç±»çš„ remove æ–¹æ³•**ã€‚

PSï¼šè¿™é‡Œè®¨è®ºçš„æ˜¯**==è¿­ä»£åˆ é™¤==æ—¶ä½¿ç”¨ ArrayList çš„ remove æ–¹æ³•**ï¼Œä¸€èˆ¬ä½¿ç”¨ ArrayList çš„ remove æ–¹æ³•æ˜¯æ²¡é—®é¢˜çš„ã€‚

#### Fail-Fastæœºåˆ¶

##### 1.æ¦‚è¿°

ä¸Šé¢çš„ä¾‹å­å°±å¯ä»¥å¼•å‡º Fail-fast æœºåˆ¶ï¼Œå³**å¿«é€Ÿå¤±è´¥æœºåˆ¶**ï¼Œæ˜¯ Java **é›†åˆ**(Collection)ä¸­çš„ä¸€ç§**é”™è¯¯æ£€æµ‹æœºåˆ¶**ã€‚å½“åœ¨==**åºåˆ—åŒ–æˆ–è€…è¿­ä»£**==é›†åˆçš„è¿‡ç¨‹ä¸­è¯¥é›†åˆåœ¨==**ç»“æ„**ä¸Šå‘ç”Ÿ**æ”¹å˜**==çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½ä¼šå‘ç”Ÿ fail-fastï¼Œå³æŠ›å‡º **ConcurrentModificationException** å¼‚å¸¸ã€‚

Fail-Fast æœºåˆ¶çš„å®ç°ä¾èµ–äº **modCount** å±æ€§ï¼Œå®ƒç»§æ‰¿è‡ª **AbstractList** çš„ï¼Œç”¨æ¥è®°å½• **ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°**ã€‚ç»“æ„å‘ç”Ÿå˜åŒ–æ˜¯æŒ‡æ·»åŠ æˆ–è€…åˆ é™¤è‡³å°‘ä¸€ä¸ªå…ƒç´ çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…æ˜¯è°ƒæ•´å†…éƒ¨æ•°ç»„çš„å¤§å°ï¼Œä»…ä»…åªæ˜¯è®¾ç½®å…ƒç´ çš„å€¼ä¸ç®—ç»“æ„å‘ç”Ÿå˜åŒ–ã€‚å¯ä»¥ç”¨äº**æ£€æŸ¥å¹¶å‘ä¿®æ”¹**çš„æƒ…å†µã€‚**modCount** æ­¤å­—æ®µç”± **iterator** å’Œ **listiterator** æ–¹æ³•è¿”å›çš„**è¿­ä»£å™¨å’Œåˆ—è¡¨è¿­ä»£å™¨**å®ç°ä½¿ç”¨ã€‚**å­ç±»**æ˜¯å¦ä½¿ç”¨æ­¤å­—æ®µæ˜¯**å¯é€‰**çš„ã€‚å¦‚æœ**å­ç±»**å¸Œæœ›æä¾›å¿«é€Ÿå¤±è´¥è¿­ä»£å™¨(å’Œåˆ—è¡¨è¿­ä»£å™¨)ï¼Œåˆ™å®ƒåªéœ€åœ¨å…¶ add(E e) å’Œ remove(int) æ–¹æ³•(ä»¥åŠå®ƒæ‰€é‡å†™çš„ã€å¯¼è‡´åˆ—è¡¨ç»“æ„ä¸Šä¿®æ”¹çš„ä»»ä½•å…¶ä»–æ–¹æ³•)ä¸­å¢åŠ æ­¤å­—æ®µã€‚å¯ä»¥çœ‹åˆ° ArrayList ä¸­çš„è¿™ä¸¤ä¸ªä»£ç éƒ½æœ‰è¿™ä¸ªæ“ä½œã€‚

```java
protected transient int modCount = 0;
```

å¸¸è§çš„ Java é›†åˆä¸­å°±å¯èƒ½å‡ºç° fail-fast æœºåˆ¶ï¼Œæ¯”å¦‚ ArrayListï¼ŒHashMapã€‚å› ä¸ºå…¶å†…éƒ¨ä¹Ÿæœ‰è¿™ä¸ªå±æ€§ã€‚

Fail-fast æœºåˆ¶å¹¶ä¸ä¿è¯åœ¨ä¸åŒæ­¥çš„ä¿®æ”¹ä¸‹ä¸€å®šä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå®ƒåªæ˜¯å°½æœ€å¤§åŠªåŠ›å»æŠ›å‡ºï¼Œæ‰€ä»¥è¿™ç§æœºåˆ¶ä¸€èˆ¬ä»…ç”¨äºæ£€æµ‹ bugã€‚

åœ¨**å¤šçº¿ç¨‹å’Œå•çº¿ç¨‹**ç¯å¢ƒä¸‹éƒ½æœ‰å¯èƒ½å‡ºç° Fail-fastã€‚

fail-fast ä¼šåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹æŠ›å‡º ConcurrentModificationExceptionï¼š

(1)**å•çº¿ç¨‹ç¯å¢ƒ**

- é›†åˆè¢«åˆ›å»ºåï¼Œåœ¨**éå†**å®ƒçš„è¿‡ç¨‹ä¸­**ä¿®æ”¹**äº†ç»“æ„ã€‚æ¯”å¦‚è°ƒç”¨äº† ArrayList è‡ªå·±å®ç°çš„ list æ¥å£ä¸­çš„ remove æ–¹æ³•ã€‚

- æ³¨æ„å†…éƒ¨è¿­ä»£å™¨æä¾›çš„ **remove**() æ–¹æ³•ä¼šè®© expectModcount å’Œ modcount **ç›¸ç­‰**ï¼Œæ‰€ä»¥æ˜¯**ä¸ä¼š**æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚

(2)**å¤šçº¿ç¨‹ç¯å¢ƒ**

- å½“ä¸€ä¸ªçº¿ç¨‹åœ¨**éå†**è¿™ä¸ªé›†åˆï¼Œè€Œ**å¦ä¸€ä¸ªçº¿ç¨‹**å¯¹è¿™ä¸ªé›†åˆçš„ç»“æ„è¿›è¡Œäº†ä¿®æ”¹ã€‚

##### 2.é¿å…fail-fast

**æ–¹æ³•1**ï¼šåœ¨**å•çº¿ç¨‹**çš„éå†è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¦è¿›è¡Œ remove æ“ä½œï¼Œåº”è¯¥è°ƒç”¨**è¿­ä»£å™¨çš„ remove** æ–¹æ³•è€Œä¸æ˜¯é›†åˆç±»çš„ remove æ–¹æ³•ã€‚

**æ–¹æ³•2**ï¼šä½¿ç”¨ JUC ä¸­çš„ç±»æ¥ä»£æ›¿ ArrayList å’Œ HashMapã€‚å¦‚ **CopyOnWriterArrayList** ä»£æ›¿ ArrayListã€‚ä½¿ç”¨ **ConcurrentHashMap** æ›¿ä»£ HashMapã€‚

#### Arrays.asList()

Arrays ç±»çš„é™æ€æ–¹æ³• asList() å°†æ•°ç»„è½¬ä¸º**é›†åˆ**ã€‚

```java
String[] str = new String[]{"1","2","3"};
List aslist = Arrays.asList(str);
aslsit.add("4");
// Exception in thread "main" java.lang.UnsupportedOperationException
//    at java.util.AbstractList.add(Unknown Source)
//    at java.util.AbstractList.add(Unknown Source)
//    at test.LinkedListTest.main(LinkedListTest.java:13)
```

å…¶å® **asList**() è¿”å›çš„æ˜¯ java.util.**Arrays.ArrayList** å¯¹è±¡ï¼Œ**ä¸æ˜¯ä¸Šè¿°çš„ ArrayList ç±»**ï¼ï¼ï¼ï¼

çœ‹ Arrays ç±»çš„éƒ¨åˆ†æºç ï¼š

```java
public class Arrays {
    
    // çœç•¥å…¶ä»–æ–¹æ³•
 
    public static <T> List<T> asList(T... a) {
        return new ArrayList<>(a);
    }
        
    // è¿™ä¸ªå†…éƒ¨ç±»å°±æ˜¯å®ƒ        ğŸ‘‡
    private static class ArrayList<E> extends AbstractList<E>
            implements RandomAccess, java.io.Serializable{
    
        private final E[] a;
    
        ArrayList(E[] array) {
            a = Objects.requireNonNull(array);
        }
    
        @Override
        public int size() {
            return a.length;
        }
        // çœç•¥å…¶ä»–æ–¹æ³•
    }
}
```

**Arrays.ArrayList** æ˜¯å·¥å…·ç±» Arrays çš„ä¸€ä¸ª**å†…éƒ¨é™æ€ç±»**ï¼Œå®ƒ**æ²¡æœ‰å®Œå…¨**å®ç° List çš„æ–¹æ³•ï¼Œè€Œ ArrayList ç›´æ¥å®ç°äº† List æ¥å£ï¼Œå®ç°äº† List æ‰€æœ‰æ–¹æ³•ã€‚Arrays.ArrayList æ˜¯ä¸€ä¸ª**å®šé•¿**é›†åˆï¼Œå› ä¸ºå®ƒ**æ²¡æœ‰é‡å†™** add, remove æ–¹æ³•ï¼Œæ‰€ä»¥ä¸€æ—¦åˆå§‹åŒ–å…ƒç´ åï¼Œé›†åˆçš„ size å°±æ˜¯**ä¸å¯å˜**çš„ã€‚æ‰€ä»¥ä½¿ç”¨è¿™ç§æ”¹å˜ç»“æ„çš„æ–¹æ³•ä¼šæŠ› UnsupportedOperationException å¼‚å¸¸ã€‚

**æ­£ç¡®**çš„ä½¿ç”¨æ–¹å¼ï¼š

```java
String[] str = new String[]{"1","2","3"};
ArrayList al = new ArrayList(Arrays.asList(str)); // å°†æ•°ç»„å…ƒç´ æ·»åŠ åˆ°é›†åˆçš„ä¸€ç§å¿«æ·æ–¹å¼
```

### LinkedList

#### åŸºç¡€

##### 1.æ‚è®°

- LinkedList ä¹Ÿå®ç°äº† List æ¥å£ï¼Œå†…éƒ¨åŸºäº**åŒå‘é“¾è¡¨**å®ç°ï¼Œæ‰€ä»¥å…¶ç‰¹ç‚¹ä¸ ArrayList å‡ ä¹**ç›¸å**ã€‚
- LinkedList è¿˜å®ç°äº† **Deque** æ¥å£ï¼Œå¯ä»¥æŒ‰ç…§**é˜Ÿåˆ—ã€æ ˆå’ŒåŒç«¯é˜Ÿåˆ—**çš„æ–¹å¼è¿›è¡Œæ“ä½œã€‚
- LinkedList ä¹Ÿæ˜¯çº¿ç¨‹**ä¸å®‰å…¨**çš„é˜Ÿåˆ—ã€‚

##### 2.åŸºæœ¬æ–¹æ³•

**ç¬”è¯•é¢è¯•**çš„æ—¶å€™å¯ä»¥ç”¨æ¥å®ç°**é˜Ÿåˆ—ã€æ ˆ**ç­‰ç»“æ„ï¼Œéå¸¸æ–¹ä¾¿ï¼Œè¦**è®°ç‰¢å‡ ä¸ª API**ã€‚å®ç°äº†Queue æ¥å£ï¼Œæ‰€ä»¥ API æœ‰ç‚¹å¤šã€‚

```java
int size();  	// å®ƒè¿”å›æ­¤åˆ—è¡¨ä¸­å…ƒç´ çš„æ•°é‡
void clear();  	// å®ƒåˆ é™¤åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ 
Object clone();	// å®ƒç”¨äºåˆ¶ä½œç°æœ‰é“¾æ¥åˆ—è¡¨çš„å‰¯æœ¬
Object set(int indexï¼ŒObject element);  // å®ƒç”¨äºç”¨æ–°å…ƒç´ æ›¿æ¢åˆ—è¡¨ä¸­çš„ç°æœ‰å…ƒç´ 
boolean contains(Object element);		// å¦‚æœå…ƒç´ å­˜åœ¨äºåˆ—è¡¨ä¸­ï¼Œåˆ™è¿”å›true
boolean add(Object element);			// å®ƒå°†å…ƒç´ é™„åŠ åˆ°åˆ—è¡¨çš„æœ«å°¾
void add(int indexï¼ŒObject element);	   // å®ƒå°†å…ƒç´ æ’å…¥åˆ—è¡¨ä¸­'index'ä½ç½®
boolean addAll(Collection C);			// å®ƒå°†ä¸€ä¸ªé›†åˆè¿½åŠ åˆ°é“¾æ¥åˆ—è¡¨
boolean addAll(int indexï¼ŒCollection C);// å®ƒå°†ä¸€ä¸ªé›†åˆè¿½åŠ åˆ°æŒ‡å®šä½ç½®çš„é“¾è¡¨ä¸­
void addFirst(Object element);			// å®ƒå°†å…ƒç´ æ’å…¥åˆ—è¡¨çš„å¼€å¤´
void addLast(Object element);			// å®ƒå°†å…ƒç´ é™„åŠ åœ¨åˆ—è¡¨çš„æœ«å°¾
Object get(int index);	// å®ƒè¿”å›åˆ—è¡¨ä¸­ä½ç½®'index'å¤„çš„å…ƒç´ ã€‚å¦‚æœç´¢å¼•è¶…å‡ºäº†åˆ—è¡¨çš„èŒƒå›´ï¼Œå®ƒä¼šæŠ›å‡º'IndexOutOfBoundsException'
Object getFirst();		// å®ƒè¿”å›é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
Object getLast();		// å®ƒè¿”å›é“¾æ¥åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ 
int indexOf(Object element);	// å¦‚æœæ‰¾åˆ°å…ƒç´ ï¼Œå®ƒå°†è¿”å›å…ƒç´ ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ã€‚å¦åˆ™ï¼Œå®ƒè¿”å›-1
int lastIndexOf(Object element);// å¦‚æœæ‰¾åˆ°å…ƒç´ ï¼Œå®ƒå°†è¿”å›å…ƒç´ æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ã€‚å¦åˆ™ï¼Œå®ƒè¿”å›-1
Object remove();		// å®ƒç”¨äºä»åˆ—è¡¨å¤´éƒ¨åˆ é™¤å¹¶è¿”å›å…ƒç´ 
Object remove(int index);		// å®ƒåˆ é™¤æ­¤åˆ—è¡¨ä¸­ä½ç½®'index'å¤„çš„å…ƒç´ ã€‚å¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œå®ƒä¼šæŠ›å‡º'NoSuchElementException'
boolean remove(Object O);		// å®ƒç”¨äºä»é“¾è¡¨ä¸­ç§»é™¤ä¸€ä¸ªç‰¹å®šçš„å…ƒç´ å¹¶è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
Object removeLast();			// å®ƒç”¨äºåˆ é™¤å¹¶è¿”å›é“¾æ¥åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ 
```

#### æºç è§£æ

##### 1.å†…éƒ¨ç»“ç‚¹ç±»

åŸºäº**åŒå‘é“¾è¡¨**å®ç°ï¼Œä½¿ç”¨å†…éƒ¨èŠ‚ç‚¹ç±» **Node** å­˜å‚¨é“¾è¡¨èŠ‚ç‚¹ä¿¡æ¯ã€‚

```java
private static class Node<E> {
    E item;			// æ•°æ®
    Node<E> next;	// åç»§ç»“ç‚¹æŒ‡é’ˆ
    Node<E> prev;	// å‰é©±ç»“ç‚¹æŒ‡é’ˆ
     
    Node(Node<E> prev, E element, Node<E> next) {
    	this.item = element;
     	this.next = next;
     	this.prev = prev;
 	}
}
```

æ¯ä¸ªé“¾è¡¨å­˜å‚¨äº† next å’Œ prev æŒ‡é’ˆï¼ŒLinkedList ä¸­çš„**é‡è¦å±æ€§**å¦‚ä¸‹:

```java
// é“¾è¡¨çš„èŠ‚ç‚¹ä¸ªæ•°
transient int size = 0;
// æŒ‡å‘å¤´èŠ‚ç‚¹çš„æŒ‡é’ˆ
transient Node<E> first;
// æŒ‡å‘å°¾èŠ‚ç‚¹çš„æŒ‡é’ˆ
transient Node<E> last;
```

å¤´å°¾æŒ‡é’ˆéƒ½æ˜¯ **transient** ä¿®é¥°çš„ã€‚

##### 2.æ·»åŠ å…ƒç´ 

å½“å‘æŒ‡å®šèŠ‚ç‚¹ä¹‹å‰æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå½“å‰èŠ‚ç‚¹çš„**åç»§ä¸ºæŒ‡å®šèŠ‚ç‚¹**ï¼Œè€Œ**å‰é©±ç»“ç‚¹ä¸ºæŒ‡å®šèŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹**ã€‚æ­¤å¤–è¿˜è¦ä¿®æ”¹å‰é©±èŠ‚ç‚¹çš„åç»§ä¸ºå½“å‰èŠ‚ç‚¹ï¼Œä»¥åŠåç»§èŠ‚ç‚¹çš„å‰é©±ä¸ºå½“å‰èŠ‚ç‚¹ã€‚

**æœ€æ™®é€š**çš„æ’å…¥å…ƒç´ æ–¹æ³•ä¸º **add()**ã€‚

```java
public boolean add(E e) {
    linkLast(e);
    return true;
}
```

è°ƒç”¨äº† linkLast() æ–¹æ³•ï¼Œæ‰€ä»¥æœ€åŸºæœ¬çš„ **add()** æ–¹æ³•å…¶å®æ˜¯**å°¾æ’å…¥**çš„ã€‚ç”±äºæ˜¯ç»´æŠ¤äº†ä¸€ä¸ª**å°¾æŒ‡é’ˆ**ï¼Œæ‰€ä»¥å°¾æ’å…¥ä¹Ÿå¾ˆè¿…é€Ÿã€‚

```java
/**
 * å°¾æ’å…¥ï¼Œå³å°†èŠ‚ç‚¹å€¼ä¸ºeçš„èŠ‚ç‚¹è®¾ç½®ä¸ºé“¾è¡¨çš„å°¾èŠ‚ç‚¹
 */
void linkLast(E e) {
    // è·å–å½“å‰å°¾ç»“ç‚¹å¼•ç”¨
    final Node<E> l = last;
    // æ„å»ºä¸€ä¸ªprevå€¼ä¸ºl,èŠ‚ç‚¹å€¼ä¸ºe,nextå€¼ä¸ºnullçš„æ–°èŠ‚ç‚¹newNode
    final Node<E> newNode = new Node<>(l, e, null);
    // å°†newNodeä½œä¸ºå°¾èŠ‚ç‚¹
    last = newNode;
    // å¦‚æœåŸå°¾èŠ‚ç‚¹ä¸ºnullï¼Œå³åŸé“¾è¡¨ä¸ºnullï¼Œåˆ™é“¾è¡¨é¦–èŠ‚ç‚¹ä¹Ÿè®¾ç½®ä¸ºnewNode
    if (l == null)
        first = newNode;
    else    // å¦åˆ™ï¼ŒåŸå°¾èŠ‚ç‚¹çš„nextè®¾ç½®ä¸ºnewNode
        l.next = newNode;
    size++;
    modCount++;
}
```

è¿˜å¯ä»¥åœ¨**æŒ‡å®š**çš„ä½ç½®åŠ å…¥å…ƒç´ ï¼š

```java
/**
 * åœ¨æŒ‡å®šä½ç½®å‰æ’å…¥æŒ‡å®šå…ƒç´ 
 *
 * @param index   æŒ‡å®šå…ƒç´ å°†è¢«æ’å…¥çš„ç´¢å¼•
 * @param element è¦æ’å…¥çš„å…ƒç´ 
 */
public void add(int index, E element) {
    // åˆ¤æ–­æŒ‡å®šä½ç½®æ˜¯å¦åˆæ³•
    checkPositionIndex(index);
    // å¦‚æœæŒ‡å®šä½ç½®åœ¨å°¾éƒ¨ï¼Œåˆ™ç›´æ¥é€šè¿‡å°¾æ’æ³•æ¥æ’å…¥æŒ‡å®šå…ƒç´ 
    if (index == size)
        linkLast(element);
    else        // å¦‚æœæŒ‡å®šä½ç½®ä¸æ˜¯å°¾éƒ¨ï¼Œåˆ™æ·»åŠ åˆ°æŒ‡å®šä½ç½®å‰
        linkBefore(element, node(index));
}
```

**linkBefore()** æ–¹æ³•å¦‚ä¸‹ï¼Œå³åœ¨**é“¾è¡¨ä¸­é—´**æ’å…¥ï¼Œåœ¨éç©ºèŠ‚ç‚¹ succ ä¹‹å‰æ’å…¥èŠ‚ç‚¹å€¼ eã€‚ä¸»è¦å°±æ˜¯è¦å„ç§**ä¿®æ”¹æŒ‡é’ˆ**ã€‚

````java
/**
 * ä¸­é—´æ’å…¥ï¼Œåœ¨éç©ºèŠ‚ç‚¹succä¹‹å‰æ’å…¥èŠ‚ç‚¹å€¼e
 */
void linkBefore(E e, Node<E> succ) {
    // assert succ != null;
    final Node<E> pred = succ.prev;
    // æ„å»ºä¸€ä¸ªprevå€¼ä¸ºsucc.prev,èŠ‚ç‚¹å€¼ä¸ºe,nextå€¼ä¸ºsuccçš„æ–°èŠ‚ç‚¹newNode
    final Node<E> newNode = new Node<>(pred, e, succ);
    // è®¾ç½®newNodeä¸ºsuccçš„å‰èŠ‚ç‚¹
    succ.prev = newNode;
    // å¦‚æœsucc.prevä¸ºnullï¼Œå³å¦‚æœsuccä¸ºé¦–èŠ‚ç‚¹ï¼Œåˆ™å°†newNodeè®¾ç½®ä¸ºé¦–èŠ‚ç‚¹
    if (pred == null)
        first = newNode;
    else        // å¦‚æœsuccä¸æ˜¯é¦–èŠ‚ç‚¹
        pred.next = newNode;
    size++;
    modCount++;	// è®°å½•ä¿®æ”¹æ¬¡æ•°
}
````

çœ‹çœ‹å¸¸ç”¨çš„å‡ ä¸ª API æ˜¯å¦‚ä½•å®ç°çš„ã€‚

```java
public void addFirst(E e) {
    linkFirst(e);
}
```

```java
public boolean offerFirst(E e) {
    addFirst(e);
    return true;
}
```

åœ¨**å¤´éƒ¨**åŠ å…ƒç´ æ—¶æœ€åéƒ½ä¼šè°ƒç”¨ linkFirst() **ç§æœ‰æ–¹æ³•**ã€‚

```java
private void linkFirst(E e) {
    final Node<E> f = first;
    final Node<E> newNode = new Node<>(null, e, f);
    first = newNode;
    if (f == null)
        last = newNode;
    else
        f.prev = newNode;
    size++;
    modCount++;
}
```

å¯¹äºåœ¨**å°¾éƒ¨**æ·»åŠ æ•°æ®ï¼Œæœ‰:

```java
public boolean offer(E e) {
    return add(e);
}
```

offer() **é»˜è®¤**è°ƒç”¨ add() æ–¹æ³•ã€‚æ­¤å¤–è¿˜æœ‰å¦‚ä¸‹æ–¹æ³•ã€‚

```java
public void addLast(E e) {
    linkLast(e);
}
```

```java
public boolean offerLast(E e) {
    addLast(e);
    return true;
}
```

##### 3.åˆ¤æ–­å­˜åœ¨

**indexOf**(Object o) åˆ¤æ–­ o é“¾è¡¨ä¸­æ˜¯å¦å­˜åœ¨èŠ‚ç‚¹çš„ element å’Œ o ç›¸ç­‰ï¼Œè‹¥ç›¸ç­‰åˆ™è¿”å›è¯¥èŠ‚ç‚¹åœ¨é“¾è¡¨ä¸­çš„ç´¢å¼•ä½ç½®ï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å› -1ã€‚

**contains**(Object o) æ–¹æ³•é€šè¿‡åˆ¤æ–­ indexOf(Object o) çš„è¿”å›å€¼è¿›è¡Œåˆ¤æ–­ã€‚

```java
public boolean contains(Object o) {
     return indexOf(o) != -1;
 }
 // ä»å‰å‘åæŸ¥æ‰¾ï¼Œè¿”å›â€œå€¼ä¸ºå¯¹è±¡(o)çš„èŠ‚ç‚¹å¯¹åº”çš„ç´¢å¼•â€  ä¸å­˜åœ¨å°±è¿”å›-1 
 public int indexOf(Object o) {
      int index = 0;
     // å½“ä¼ å…¥ä¸ºnullæ—¶åˆ™æ‰¾ç¬¬ä¸€ä¸ªä¸ä¸ºnullçš„ç»“ç‚¹
      if (o == null) {
          for (Entry e = header.next; e != header; e = e.next) {
              if (e.element == null)
                  return index;
              index++;
         }
          // å¦åˆ™é¡ºåºéå†æ‰¾ç»“ç‚¹
      } else {
         for (Entry e = header.next; e != header; e = e.next) {
             if (o.equals(e.element))
                 return index;
             index++;
        }
    }
     return -1;
 }
```

##### 4.è·å–æ•°æ®

**get**(int) æ–¹æ³•ç”¨äºè·å–**æŒ‡å®šä½ç½®**çš„æ•°æ®ã€‚é¦–å…ˆåˆ¤æ–­ä½ç½®ä¿¡æ¯æ˜¯å¦**åˆæ³•**(å¤§äºç­‰äº0ï¼Œå°äºå½“å‰ LinkedList å®ä¾‹çš„ Size)ï¼Œç„¶å**éå†**åˆ°å…·ä½“ä½ç½®ï¼Œè·å¾—èŠ‚ç‚¹çš„ä¸šåŠ¡æ•°æ®(element)å¹¶è¿”å›ã€‚

```java
public E get(int index) {
    // æ£€æŸ¥ç´¢å¼•åˆæ³•æ€§
    checkElementIndex(index);
    // è·å–æŒ‡å®šç´¢å¼•æ•°æ®
    return node(index).item;
}
```

ç„¶åè°ƒç”¨ node çš„**å†…éƒ¨æ–¹æ³•**è·å–å…ƒç´ ã€‚æ³¨æ„ï¼šç”±äºå…·æœ‰**åŒå‘æŒ‡é’ˆ**ï¼Œæ‰€ä»¥æŸ¥æ‰¾æ—¶ä¼šåˆ¤æ–­å¾…æœç´¢çš„**ç´¢å¼•**ä¸æ•´ä¸ªé“¾è¡¨çš„**é•¿åº¦**å…³ç³»ï¼Œå¦‚æœ**å°äºé“¾è¡¨é•¿åº¦ä¸€åŠ**ï¼Œé‚£ä¹ˆå°±ä»å¤´éå†ï¼Œå¦åˆ™ä»å°¾éƒ¨éå†ï¼Œè¿™æ ·æœ€å¤šä¹Ÿå°±éå†åŠä¸ªé“¾è¡¨é•¿åº¦ã€‚å¯ä»¥**æé«˜æŸ¥æ‰¾æ•ˆç‡**ã€‚

```java
/**
 * è·å–æŒ‡å®šä¸‹æ ‡çš„ç»“ç‚¹ï¼Œindexä»0å¼€å§‹
 */
Node<E> node(int index) {
    // å¦‚æœæŒ‡å®šä¸‹æ ‡å°äºä¸€åŠå…ƒç´ æ•°é‡ï¼Œåˆ™ä»é¦–ç»“ç‚¹å¼€å§‹éå†
    if (index < (size >> 1)) {
        Node<E> x = first;
        for (int i = 0; i < index; i++)
            x = x.next;
        return x;
    // å¦åˆ™ï¼Œä»å°¾ç»“ç‚¹å¼€å§‹éå†
    } else {
        Node<E> x = last;
        for (int i = size - 1; i > index; i--)
            x = x.prev;
        return x;
    }
}
```

æ³¨æ„ç»†èŠ‚ï¼š**ä½è¿ç®—**ä¸ç›´æ¥åšé™¤æ³•çš„åŒºåˆ«ã€‚å…ˆå°† index ä¸é•¿åº¦ size çš„**ä¸€åŠ**æ¯”è¾ƒï¼Œå¦‚æœ index < size / 2ï¼Œå°±åªä»ä½ç½® **0 å¾€å**éå†åˆ°ä½ç½® index å¤„ï¼Œè€Œå¦‚æœ index > size / 2ï¼Œå°±åªä»ä½ç½® size å¾€å‰éå†åˆ°ä½ç½® index å¤„ã€‚

##### 5.åˆ é™¤æ•°æ®

**åˆ é™¤**æŒ‡å®šä½ç½®çš„å…ƒç´ ç”¨ remove() æ–¹æ³•ã€‚

```java
public E remove(int index) {
    checkElementIndex(index);
    return unlink(node(index));
}
```

unlink() å®ç°çœŸæ­£çš„åˆ é™¤é€»è¾‘ã€‚

```java
/**
 * åˆ é™¤æŒ‡å®šéç©ºç»“ç‚¹ï¼Œè¿”å›å­˜å‚¨çš„å…ƒç´ 
 */
E unlink(Node<E> x) {
    // è·å–æŒ‡å®šéç©ºç»“ç‚¹å­˜å‚¨çš„å…ƒç´ 
    final E element = x.item;
    // è·å–æŒ‡å®šéç©ºç»“ç‚¹çš„åç»§ç»“ç‚¹
    final Node<E> next = x.next;
    // è·å–æŒ‡å®šéç©ºç»“ç‚¹çš„å‰é©±ç»“ç‚¹
    final Node<E> prev = x.prev;

    /**
     * å¦‚æœæŒ‡å®šéç©ºç»“ç‚¹çš„å‰é©±ç»“ç‚¹ä¸ºç©ºï¼Œåˆ™æŒ‡å®šéç©ºç»“ç‚¹çš„åç»§ç»“ç‚¹è®¾ä¸ºé¦–ç»“ç‚¹
     * å¦åˆ™ï¼ŒæŒ‡å®šéç©ºç»“ç‚¹çš„åç»§ç»“ç‚¹è®¾ä¸ºæŒ‡å®šéç©ºç»“ç‚¹çš„å‰é©±ç»“ç‚¹çš„åç»§ç»“ç‚¹ï¼Œ
     * æŒ‡å®šéç©ºç»“ç‚¹çš„å‰é©±ç»“ç‚¹è®¾ä¸ºnull
     */
    if (prev == null) {
        first = next;
    } else {
        prev.next = next;
        x.prev = null;
    }

    /**
     * å¦‚æœæŒ‡å®šéç©ºç»“ç‚¹çš„åç»§ç»“ç‚¹ä¸ºç©ºï¼Œåˆ™æŒ‡å®šéç©ºç»“ç‚¹çš„å‰é©±ç»“ç‚¹è®¾ä¸ºå°¾ç»“ç‚¹
     * å¦åˆ™ï¼ŒæŒ‡å®šéç©ºç»“ç‚¹çš„å‰é©±ç»“ç‚¹è®¾ä¸ºæŒ‡å®šéç©ºç»“ç‚¹çš„åç»§ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ï¼Œ
     * æŒ‡å®šéç©ºç»“ç‚¹çš„åç»§ç»“ç‚¹è®¾ä¸ºnull
     */
    if (next == null) {
        last = prev;
    } else {
        next.prev = prev;
        x.next = null;
    }

    // æŒ‡å®šéç©ºç»“ç‚¹å­˜å‚¨çš„å…ƒç´ è®¾ä¸ºnull
    x.item = null;
    size--;
    // è®°å½•ç»“æ„å˜åŒ–
    modCount++;
    // è¿”å›æŒ‡å®šéç©ºç»“ç‚¹å­˜å‚¨çš„å…ƒç´ 
    return element;
}
```

ä¸ ArrayList æ¯”è¾ƒè€Œè¨€ï¼ŒLinkedList çš„åˆ é™¤åŠ¨ä½œ**ä¸éœ€è¦"ç§»åŠ¨"å¾ˆå¤š**æ•°æ®ï¼Œä»è€Œæ•ˆç‡æ›´é«˜ã€‚è€Œä¸”åˆ é™¤æ—¶ä¼š**ä¼ å…¥**è¿™ä¸ªç»“ç‚¹ï¼Œæ‰€ä»¥ä¸ç”¨éå†å»å¯»æ‰¾è¿™ä¸ªç»“ç‚¹ï¼Œè´¼å¿«ã€‚

#### ä¸ArrayListæ¯”è¾ƒ

- **æ•°æ®ç»“æ„ä¸å®ç°**ï¼šArrayList åŸºäº**åŠ¨æ€æ•°ç»„**å®ç°ï¼ŒLinkedList åŸºäº**åŒå‘é“¾è¡¨**å®ç°ï¼›
- **çº¿ç¨‹å®‰å…¨æ€§**ï¼šArrayList å’Œ LinkedList **éƒ½ä¸**ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚
- **å…ƒç´ è®¿é—®**ï¼šArrayList æ”¯æŒå¿«é€Ÿ**éšæœºè®¿é—®**ï¼ŒLinkedList **ä¸æ”¯æŒ**ã€‚
- **å¢åˆ å…ƒç´ æ•ˆç‡**ï¼š ArrayList é‡‡ç”¨**æ•°ç»„**å­˜å‚¨ï¼Œæ’å…¥å…ƒç´ åˆ°æ•°ç»„æœ«å°¾å¤æ‚åº¦ä¸º O(1)ï¼Œä½†æ˜¯åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ ä¸åˆ é™¤å…ƒç´ å¤æ‚åº¦ä¸º O(N)ã€‚LinkedList é‡‡ç”¨**é“¾è¡¨**å­˜å‚¨ï¼Œåœ¨åˆ é™¤å…ƒç´ çš„æ—¶å€™ä¸éœ€è¦æŒªåŠ¨åé¢çš„å…ƒç´ ï¼Œæ“ä½œåŸºæœ¬éƒ½æ˜¯ä¿®æ”¹æŒ‡é’ˆï¼ŒLinkedList åœ¨**ä»»æ„ä½ç½®**æ·»åŠ åˆ é™¤å…ƒç´ **æ›´å¿«**ã€‚
- **å†…å­˜ç©ºé—´å ç”¨**ï¼šArrayList çš„ç©ºé—´æµªè´¹ä¸»è¦ä½“ç°åœ¨ list åˆ—è¡¨çš„ç»“å°¾ä¼šé¢„ç•™ä¸€å®šçš„**å®¹é‡ç©ºé—´**ï¼Œè€Œ LinkedList çš„ç©ºé—´èŠ±è´¹åˆ™ä½“ç°åœ¨å®ƒçš„æ¯ä¸€ä¸ªç»“ç‚¹éƒ½éœ€è¦æ¶ˆè€—æ¯” ArrayList æ›´å¤šçš„ç©ºé—´ã€‚





#### å‚è€ƒèµ„æ–™

- [ArrayListçº¿ç¨‹å®‰å…¨é—®é¢˜](https://www.cnblogs.com/zhouyuxin/p/11154771.html)







